"use strict";var map,restaurant=void 0,reviews=void 0;window.initMap=function(){fetchRestaurantFromURL(function(e,t){e?console.error(e):(self.map=new google.maps.Map(document.getElementById("map"),{zoom:16,center:t.latlng,scrollwheel:!1}),fillBreadcrumb(),DBHelper.mapMarkerForRestaurant(self.restaurant,self.map))})};var fetchRestaurantFromURL=function(r){if(self.restaurant)r(null,self.restaurant);else{var e=getParameterByName("id");e?DBHelper.fetchRestaurantById(e,function(e,t){(self.restaurant=t)?(fillRestaurantHTML(),r(null,t)):console.error(e)}):(error="No restaurant id in URL",r(error,null))}},fillRestaurantHTML=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurant;document.getElementById("restaurant-name").innerHTML=e.name,document.getElementById("restaurant-address").innerHTML=e.address;var t=DBHelper.imageUrlForRestaurant(e);document.getElementById("restaurant-source-large-webp").srcset=t+"-1600_large.webp 2x, "+t+"-800_large.webp",document.getElementById("restaurant-source-large").srcset=t+"-1600_large.jpg 2x, "+t+"-800_large.jpg",document.getElementById("restaurant-source-medium-webp").srcset=DBHelper.imageUrlForRestaurant(e)+"_medium.webp",document.getElementById("restaurant-source-medium").srcset=DBHelper.imageUrlForRestaurant(e)+"_medium.jpg",document.getElementById("restaurant-source-webp").srcset=DBHelper.imageUrlForRestaurant(e)+".webp";var r=document.getElementById("restaurant-img");r.className="restaurant-img",r.src=DBHelper.imageUrlForRestaurant(e)+".jpg",r.alt=e.name+" is a "+e.cuisine_type+" restaurant in "+e.address+".",document.getElementById("restaurant-cuisine").innerHTML=e.cuisine_type,e.operating_hours&&fillRestaurantHoursHTML(),DBHelper.fetchReviewsByRestaurantId(self.restaurant.id,function(e,t){self.restaurant.reviews=t,fillReviewsHTML()})},fillRestaurantHoursHTML=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurant.operating_hours,t=document.getElementById("restaurant-hours");for(var r in e){var n=document.createElement("tr"),a=document.createElement("td");a.innerHTML=r,n.appendChild(a);var l=document.createElement("td");l.innerHTML=e[r],n.appendChild(l),t.appendChild(n)}},fillReviewsHTML=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurant.reviews,t=document.getElementById("reviews-container"),r=document.createElement("h3");if(r.innerHTML="Reviews",!e){var n=document.createElement("p");return n.innerHTML="No reviews yet!",void t.appendChild(n)}var a=document.getElementById("reviews-list");e.forEach(function(e){console.log(e),a.appendChild(createReviewHTML(e))}),t.prepend(a),t.prepend(r)},createReviewHTML=function(e){var t=document.createElement("li"),r=document.createElement("p");r.innerHTML=e.name,t.appendChild(r);var n=document.createElement("p");n.innerHTML=new Date(e.updatedAt).toDateString(),t.appendChild(n);var a=document.createElement("p");a.innerHTML="Rating: "+e.rating,t.appendChild(a);var l=document.createElement("p");return l.innerHTML=e.comments,t.appendChild(l),t},fillBreadcrumb=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurant,t=document.getElementById("breadcrumb"),r=document.createElement("li");r.setAttribute("aria-current","page"),r.innerHTML=e.name,t.appendChild(r)},getParameterByName=function(e,t){t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");var r=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(t);return r?r[2]?decodeURIComponent(r[2].replace(/\+/g," ")):"":null};
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInJlc3RhdXJhbnRfaW5mby5qcyJdLCJuYW1lcyI6WyJtYXAiLCJyZXN0YXVyYW50Iiwid2luZG93IiwiaW5pdE1hcCIsImZldGNoUmVzdGF1cmFudEZyb21VUkwiLCJlcnJvciIsInNlbGYiLCJnb29nbGUiLCJtYXBzIiwiTWFwIiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsImNvbnNvbGUiLCJjZW50ZXIiLCJsYXRsbmciLCJzY3JvbGx3aGVlbCIsImNhbGxiYWNrIiwiaWQiLCJnZXRQYXJhbWV0ZXJCeU5hbWUiLCJEQkhlbHBlciIsImZldGNoUmVzdGF1cmFudEJ5SWQiLCJmaWxsUmVzdGF1cmFudEhUTUwiLCJhcmd1bWVudHMiLCJsZW5ndGgiLCJ1bmRlZmluZWQiLCJuYW1lIiwiaW5uZXJIVE1MIiwiYWRkcmVzcyIsImltYWdlVXJsRm9yUmVzdGF1cmFudCIsImltZ1NvdXJjZSIsImxhcmdlU291cmNlV2VicCIsInNyY3NldCIsIm1lZGl1bVNvdXJjZVdlYnAiLCJtZWRpdW1Tb3VyY2UiLCJ3ZWJwU291cmNlIiwiaW1hZ2UiLCJzcmMiLCJjdWlzaW5lX3R5cGUiLCJhbHQiLCJjdWlzaW5lIiwiZmlsbFJlc3RhdXJhbnRIb3Vyc0hUTUwiLCJyZXZpZXdzIiwiZmlsbFJldmlld3NIVE1MIiwib3BlcmF0aW5nSG91cnMiLCJvcGVyYXRpbmdfaG91cnMiLCJob3VycyIsImNyZWF0ZUVsZW1lbnQiLCJkYXkiLCJyb3ciLCJrZXkiLCJhcHBlbmRDaGlsZCIsInRpbWUiLCJjb250YWluZXIiLCJ0aXRsZSIsIm5vUmV2aWV3cyIsInVsIiwiY3JlYXRlUmV2aWV3SFRNTCIsInJldmlldyIsImZvckVhY2giLCJsaSIsImRhdGUiLCJ1cGRhdGVkQXQiLCJ0b0RhdGVTdHJpbmciLCJyYXRpbmciLCJjb21tZW50cyIsImZpbGxCcmVhZGNydW1iIiwiYnJlYWRjcnVtYiIsInNldEF0dHJpYnV0ZSIsInVybCIsImxvY2F0aW9uIiwiaHJlZiIsInJlcGxhY2UiLCJy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LE9BQUFtRSxTQUFBQyxNQWNFN0MsRUFBT0EsRUFBSzhDLFFBQVEsVUFBVyxRQU5qQyxJQVFJQyxFQVJKLElBQUFDLE9BQUEsT0FBQWhELEVBQUEscUJBUW9CaUQsS0FBS04sR0FDdkIsT0FBS0ksRUFMQUosRUFDSEEsR0FFSU8sbUJBQVFILEVBQWtCL0MsR0FBbEI4QyxRQUFBLE1BQUEsTUFEUDlDLEdBSExQIiwiZmlsZSI6InJlc3RhdXJhbnRfaW5mby5qcyIsInNvdXJjZXNDb250ZW50IjpbImxldCByZXN0YXVyYW50O1xudmFyIG1hcDtcbmxldCByZXZpZXdzO1xuXG4vKipcbiAqIEluaXRpYWxpemUgR29vZ2xlIG1hcCwgY2FsbGVkIGZyb20gSFRNTC5cbiAqL1xud2luZG93LmluaXRNYXAgPSAoKSA9PiB7XG4gIGZldGNoUmVzdGF1cmFudEZyb21VUkwoKGVycm9yLCByZXN0YXVyYW50KSA9PiB7XG4gICAgaWYgKGVycm9yKSB7IC8vIEdvdCBhbiBlcnJvciFcbiAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xuICAgIH0gZWxzZSB7XG4gICAgICBzZWxmLm1hcCA9IG5ldyBnb29nbGUubWFwcy5NYXAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21hcCcpLCB7XG4gICAgICAgIHpvb206IDE2LFxuICAgICAgICBjZW50ZXI6IHJlc3RhdXJhbnQubGF0bG5nLFxuICAgICAgICBzY3JvbGx3aGVlbDogZmFsc2VcbiAgICAgIH0pO1xuICAgICAgZmlsbEJyZWFkY3J1bWIoKTtcbiAgICAgIERCSGVscGVyLm1hcE1hcmtlckZvclJlc3RhdXJhbnQoc2VsZi5yZXN0YXVyYW50LCBzZWxmLm1hcCk7XG4gICAgfVxuICB9KTtcblxuXG59O1xuXG5cblxuLyoqXG4gKiBHZXQgY3VycmVudCByZXN0YXVyYW50IGZyb20gcGFnZSBVUkwuXG4gKi9cbnZhciBmZXRjaFJlc3RhdXJhbnRGcm9tVVJMID0gKGNhbGxiYWNrKSA9PiB7XG4gIGlmIChzZWxmLnJlc3RhdXJhbnQpIHsgLy8gcmVzdGF1cmFudCBhbHJlYWR5IGZldGNoZWQhXG4gICAgY2FsbGJhY2sobnVsbCwgc2VsZi5yZXN0YXVyYW50KTtcbiAgICByZXR1cm47XG4gIH1cbiAgY29uc3QgaWQgPSBnZXRQYXJhbWV0ZXJCeU5hbWUoJ2lkJyk7XG4gIGlmICghaWQpIHsgLy8gbm8gaWQgZm91bmQgaW4gVVJMXG4gICAgZXJyb3IgPSAnTm8gcmVzdGF1cmFudCBpZCBpbiBVUkwnO1xuICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcbiAgfSBlbHNlIHtcbiAgICBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRCeUlkKGlkLCAoZXJyb3IsIHJlc3RhdXJhbnQpID0+IHtcbiAgICAgIHNlbGYucmVzdGF1cmFudCA9IHJlc3RhdXJhbnQ7XG4gICAgICBpZiAoIXJlc3RhdXJhbnQpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgZmlsbFJlc3RhdXJhbnRIVE1MKCk7XG4gICAgICBjYWxsYmFjayhudWxsLCByZXN0YXVyYW50KTtcbiAgICB9KTtcbiAgfVxufTtcblxuLyoqXG4gKiBDcmVhdGUgcmVzdGF1cmFudCBIVE1MIGFuZCBhZGQgaXQgdG8gdGhlIHdlYnBhZ2VcbiAqL1xudmFyIGZpbGxSZXN0YXVyYW50SFRNTCA9IChyZXN0YXVyYW50ID0gc2VsZi5yZXN0YXVyYW50KSA9PiB7XG4gIGNvbnN0IG5hbWUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudC1uYW1lJyk7XG4gIG5hbWUuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5uYW1lO1xuXG4gIGNvbnN0IGFkZHJlc3MgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudC1hZGRyZXNzJyk7XG4gIGFkZHJlc3MuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5hZGRyZXNzO1xuXG4gIGNvbnN0IGltZ1NvdXJjZSA9IERCSGVscGVyLmltYWdlVXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KTtcblxuICBjb25zdCBsYXJnZVNvdXJjZVdlYnAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudC1zb3VyY2UtbGFyZ2Utd2VicCcpO1xuICBsYXJnZVNvdXJjZVdlYnAuc3Jjc2V0ID0gaW1nU291cmNlICsgJy0xNjAwX2xhcmdlLndlYnAgMngsICcgKyBpbWdTb3VyY2UgKyctODAwX2xhcmdlLndlYnAnO1xuXG4gIGNvbnN0IGxhcmdlU291cmNlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnQtc291cmNlLWxhcmdlJyk7XG4gIGxhcmdlU291cmNlLnNyY3NldCA9IGltZ1NvdXJjZSArICctMTYwMF9sYXJnZS5qcGcgMngsICcgKyBpbWdTb3VyY2UgKyctODAwX2xhcmdlLmpwZyc7XG5cbiAgY29uc3QgbWVkaXVtU291cmNlV2VicCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50LXNvdXJjZS1tZWRpdW0td2VicCcpO1xuICBtZWRpdW1Tb3VyY2VXZWJwLnNyY3NldCA9IERCSGVscGVyLmltYWdlVXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KSArICdfbWVkaXVtLndlYnAnO1xuXG4gIGNvbnN0IG1lZGl1bVNvdXJjZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50LXNvdXJjZS1tZWRpdW0nKTtcbiAgbWVkaXVtU291cmNlLnNyY3NldCA9IERCSGVscGVyLmltYWdlVXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KSArICdfbWVkaXVtLmpwZyc7XG5cbiAgY29uc3Qgd2VicFNvdXJjZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50LXNvdXJjZS13ZWJwJyk7XG4gIHdlYnBTb3VyY2Uuc3Jjc2V0ID0gREJIZWxwZXIuaW1hZ2VVcmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpICsgJy53ZWJwJztcblxuICBjb25zdCBpbWFnZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50LWltZycpO1xuICBpbWFnZS5jbGFzc05hbWUgPSAncmVzdGF1cmFudC1pbWcnO1xuICBpbWFnZS5zcmMgPSBEQkhlbHBlci5pbWFnZVVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCkgKyAnLmpwZyc7XG4gIGltYWdlLmFsdCA9IHJlc3RhdXJhbnQubmFtZSArICcgaXMgYSAnICsgcmVzdGF1cmFudC5jdWlzaW5lX3R5cGUgKyAnIHJlc3RhdXJhbnQgaW4gJyArIHJlc3RhdXJhbnQuYWRkcmVzcyArICcuJztcblxuICBjb25zdCBjdWlzaW5lID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnQtY3Vpc2luZScpO1xuICBjdWlzaW5lLmlubmVySFRNTCA9IHJlc3RhdXJhbnQuY3Vpc2luZV90eXBlO1xuXG4gIC8vIGZpbGwgb3BlcmF0aW5nIGhvdXJzXG4gIGlmIChyZXN0YXVyYW50Lm9wZXJhdGluZ19ob3Vycykge1xuICAgIGZpbGxSZXN0YXVyYW50SG91cnNIVE1MKCk7XG4gIH1cblxuICBEQkhlbHBlci5mZXRjaFJldmlld3NCeVJlc3RhdXJhbnRJZChzZWxmLnJlc3RhdXJhbnQuaWQsIChlcnJvciwgcmV2aWV3cykgPT4ge1xuICAgIHNlbGYucmVzdGF1cmFudC5yZXZpZXdzID0gcmV2aWV3cztcbiAgICBmaWxsUmV2aWV3c0hUTUwoKTtcbiAgfSk7XG5cbn07XG5cbi8qKlxuICogQ3JlYXRlIHJlc3RhdXJhbnQgb3BlcmF0aW5nIGhvdXJzIEhUTUwgdGFibGUgYW5kIGFkZCBpdCB0byB0aGUgd2VicGFnZS5cbiAqL1xudmFyIGZpbGxSZXN0YXVyYW50SG91cnNIVE1MID0gKG9wZXJhdGluZ0hvdXJzID0gc2VsZi5yZXN0YXVyYW50Lm9wZXJhdGluZ19ob3VycykgPT4ge1xuICBjb25zdCBob3VycyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50LWhvdXJzJyk7XG4gIGZvciAobGV0IGtleSBpbiBvcGVyYXRpbmdIb3Vycykge1xuICAgIGNvbnN0IHJvdyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RyJyk7XG5cbiAgICBjb25zdCBkYXkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZCcpO1xuICAgIGRheS5pbm5lckhUTUwgPSBrZXk7XG4gICAgcm93LmFwcGVuZENoaWxkKGRheSk7XG5cbiAgICBjb25zdCB0aW1lID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGQnKTtcbiAgICB0aW1lLmlubmVySFRNTCA9IG9wZXJhdGluZ0hvdXJzW2tleV07XG4gICAgcm93LmFwcGVuZENoaWxkKHRpbWUpO1xuXG4gICAgaG91cnMuYXBwZW5kQ2hpbGQocm93KTtcbiAgfVxufTtcblxuLyoqXG4gKiBDcmVhdGUgYWxsIHJldmlld3MgSFRNTCBhbmQgYWRkIHRoZW0gdG8gdGhlIHdlYnBhZ2UuXG4gKi9cbnZhciBmaWxsUmV2aWV3c0hUTUwgPSAocmV2aWV3cyA9IHNlbGYucmVzdGF1cmFudC5yZXZpZXdzKSA9PiB7XG4gIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXZpZXdzLWNvbnRhaW5lcicpO1xuICBjb25zdCB0aXRsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2gzJyk7XG4gIHRpdGxlLmlubmVySFRNTCA9ICdSZXZpZXdzJztcblxuXG4gIGlmICghcmV2aWV3cykge1xuICAgIGNvbnN0IG5vUmV2aWV3cyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcbiAgICBub1Jldmlld3MuaW5uZXJIVE1MID0gJ05vIHJldmlld3MgeWV0ISc7XG4gICAgY29udGFpbmVyLmFwcGVuZENoaWxkKG5vUmV2aWV3cyk7XG4gICAgcmV0dXJuO1xuICB9XG4gIGNvbnN0IHVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jldmlld3MtbGlzdCcpO1xuICByZXZpZXdzLmZvckVhY2gocmV2aWV3ID0+IHtcbiAgICBjb25zb2xlLmxvZyhyZXZpZXcpO1xuICAgIHVsLmFwcGVuZENoaWxkKGNyZWF0ZVJldmlld0hUTUwocmV2aWV3KSk7XG4gIH0pO1xuICBjb250YWluZXIucHJlcGVuZCh1bCk7XG4gIGNvbnRhaW5lci5wcmVwZW5kKHRpdGxlKTtcbn07XG5cbi8qKlxuICogQ3JlYXRlIHJldmlldyBIVE1MIGFuZCBhZGQgaXQgdG8gdGhlIHdlYnBhZ2UuXG4gKi9cbnZhciBjcmVhdGVSZXZpZXdIVE1MID0gKHJldmlldykgPT4ge1xuICBjb25zdCBsaSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpJyk7XG4gIGNvbnN0IG5hbWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XG4gIG5hbWUuaW5uZXJIVE1MID0gcmV2aWV3Lm5hbWU7XG4gIGxpLmFwcGVuZENoaWxkKG5hbWUpO1xuXG4gIGNvbnN0IGRhdGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XG4gIGRhdGUuaW5uZXJIVE1MID0gbmV3IERhdGUocmV2aWV3LnVwZGF0ZWRBdCkudG9EYXRlU3RyaW5nKCk7XG4gIGxpLmFwcGVuZENoaWxkKGRhdGUpO1xuXG4gIGNvbnN0IHJhdGluZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcbiAgcmF0aW5nLmlubmVySFRNTCA9IGBSYXRpbmc6ICR7cmV2aWV3LnJhdGluZ31gO1xuICBsaS5hcHBlbmRDaGlsZChyYXRpbmcpO1xuXG4gIGNvbnN0IGNvbW1lbnRzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xuICBjb21tZW50cy5pbm5lckhUTUwgPSByZXZpZXcuY29tbWVudHM7XG4gIGxpLmFwcGVuZENoaWxkKGNvbW1lbnRzKTtcblxuICByZXR1cm4gbGk7XG59O1xuXG4vKipcbiAqIEFkZCByZXN0YXVyYW50IG5hbWUgdG8gdGhlIGJyZWFkY3J1bWIgbmF2aWdhdGlvbiBtZW51XG4gKi9cbnZhciBmaWxsQnJlYWRjcnVtYiA9IChyZXN0YXVyYW50PXNlbGYucmVzdGF1cmFudCkgPT4ge1xuICBjb25zdCBicmVhZGNydW1iID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2JyZWFkY3J1bWInKTtcbiAgY29uc3QgbGkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsaScpO1xuICBsaS5zZXRBdHRyaWJ1dGUoJ2FyaWEtY3VycmVudCcsICdwYWdlJyk7XG4gIGxpLmlubmVySFRNTCA9IHJlc3RhdXJhbnQubmFtZTtcbiAgYnJlYWRjcnVtYi5hcHBlbmRDaGlsZChsaSk7XG59O1xuXG4vKipcbiAqIEdldCBhIHBhcmFtZXRlciBieSBuYW1lIGZyb20gcGFnZSBVUkwuXG4gKi9cbnZhciBnZXRQYXJhbWV0ZXJCeU5hbWUgPSAobmFtZSwgdXJsKSA9PiB7XG4gIGlmICghdXJsKVxuICAgIHVybCA9IHdpbmRvdy5sb2NhdGlvbi5ocmVmO1xuICBuYW1lID0gbmFtZS5yZXBsYWNlKC9bXFxbXFxdXS9nLCAnXFxcXCQmJyk7XG4gIGNvbnN0IHJlZ2V4ID0gbmV3IFJlZ0V4cChgWz8mXSR7bmFtZX0oPShbXiYjXSopfCZ8I3wkKWApLFxuICAgIHJlc3VsdHMgPSByZWdleC5leGVjKHVybCk7XG4gIGlmICghcmVzdWx0cylcbiAgICByZXR1cm4gbnVsbDtcbiAgaWYgKCFyZXN1bHRzWzJdKVxuICAgIHJldHVybiAnJztcbiAgcmV0dXJuIGRlY29kZVVSSUNvbXBvbmVudChyZXN1bHRzWzJdLnJlcGxhY2UoL1xcKy9nLCAnICcpKTtcbn07XG4iXX0=
